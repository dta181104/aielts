<div *ngIf="course as detail; else stateBlock" class="detail-container">
  <div class="detail-header">
    <app-button variant="ghost" (pressed)="back()">← Quay lại</app-button>
    <div class="detail-badges">
      <span class="badge-level">{{ getTypeLabel(detail.courseType) }}</span>
      <span class="badge-status">{{ getStatusLabel(detail.status) }}</span>
    </div>
  </div>

  <div class="image-section">
    <img [src]="getDisplayImage()" [alt]="detail.title" class="main-image" />
  </div>

  <div class="info-section">
    <h2 class="product-name">{{ detail.title }}</h2>
    <p class="product-description">{{ detail.description || 'Nội dung khóa học đang được cập nhật.' }}</p>

    <ul class="product-meta">
      <li *ngIf="detail.levelName"><strong>Level:</strong> {{ detail.levelName }}</li>
      <li *ngIf="detail.targetBand"><strong>Target band:</strong> {{ detail.targetBand }}</li>
      <li><strong>Loại khóa:</strong> {{ getTypeLabel(detail.courseType) }}</li>
      <li *ngIf="detail.createdDate"><strong>Ngày tạo:</strong> {{ detail.createdDate | date:'dd/MM/yyyy' }}</li>
    </ul>

    <div class="price-row">
      <h3 class="price">{{ detail.price || 0 | number:'1.0-0' }} đ</h3>
      <div class="actions">
        <app-button variant="primary" size="md" (pressed)="addToCart()">Đăng ký ngay</app-button>
        <app-button variant="secondary" size="sm" (pressed)="back()">Xem các khóa khác</app-button>
      </div>
    </div>

    <div class="features" *ngIf="sections.length">
      <h4>Nội dung khóa học</h4>
      <div class="section-list">
        <article *ngFor="let section of sections" class="section-item">
          <div>
            <strong>{{ section.title }}</strong>
            <p>{{ section.lessons?.length || 0 }} bài học • Thứ tự: {{ section.orderIndex ?? '—' }}</p>
          </div>
        </article>
      </div>
    </div>
  </div>
</div>

<ng-template #stateBlock>
  <p class="loading-text" *ngIf="loading">Đang tải thông tin khóa học...</p>
  <p class="loading-text error" *ngIf="!loading">{{ errorMessage || 'Không tìm thấy khóa học.' }}</p>
</ng-template>
